# Vulnerability Scanning with MSF
### Objective
Exploring process of performing vulnerability scans with **Metasploit framework**

#### Lab environment
- Metasploitable3
#### Vulnerability Scanning
- The process of scanning a target system for vulnerabilities.
- Verifying whether these vulnerablities can be exploited.
#### Demo
\* Target machine on same local network  

**Step 1**  
Identifyig target IP
`-sn` quick ping
```bash
sudo nmap -sn 10.10.10.1/24
```
-> shows 2 VM IPs (Target and my own)
To identify target IP, run
```bash
ip a s
```
to check IP address attacking with.

**Step 2**
Ensure PostSQL database service started
Then start Metasploit framework console
```bash
msfconsole
```
Check if database is connected
```bash
db_status
```
Should see
```bash
Connected to msf. Connection type: postgresql.
```
Set variable **globally**
-> target IP always configured
```bash
setg RHOSTS 10.10.10.4
```
```bash
setg RHOST 10.10.10.4
```
Create workspace (name: MS3)
```bash
workspace -a MS3
```
Sin scan, service detection, version detection and operating system detection  
This gives you ports, status, services running on the ports and version
```bash
db_nmap -sS -sV -O 10.10.10.4
```
Check OS
Gives you IP, MAC address, OS name etc
```bash
hosts
```
Check services
Shows host, port, protocol, service name, state and info
```bash
servies
```
**Step 3**
Search exploits of version (manually))
This gives you matching modules so find version running
e.g. IIS
```bash
search type:exploit name:Microsoft IIS (optional: add version)
```
See if the module is available for service I found
```bash
use <copy and paste the module name>
```
(Check payload if it says "No payload configured" because it can't send Linux payload to Windows system)  
```bash
set payload windows/meterpreter/reverse_tcp
```
Make sure if it work on  the version
```bash
info
```
Read output description.

```bash
show options
```
Analyze  
Provide list of vulnerabilities particular services suffer from  
or can be exploited
```bash
analyze
```
Detect a vulnerability for SMB
```bash
vulns
```

#### Use inbuilt utility (search exploit)
**Step 1**
```bash
searchsploit "Microsoft Windows SMB"
```
```bash
# Specify module
searchsploit "Microsoft Windows SMB" | grep -e "Metasploit"
```
Before running, I must do
```bash
show option
```
To check module I loaded  
|Field|Meaning|
|---|---|
|`RHOSTS`/`RHOST`|Target IP(s)|
|`LHOST`/`LPORT`|My own IP and listener port|
|`SESSION`|Which session to use|
**Step 2**
Run
```bash
run
```
Output example
```bash
[+]10.10.10.4:445 -Host is likely VULNERABLE to MS-170-010! ....
```

#### Pligin for the Metasploit
**Step 1**  
Go to Github, search "metasploit-autopwn"  
Copy link from the page  
Open new Terminal  
```bash
cd Downloads/
```
Paste the link there
Move the file into Metaslpoit file
```bash
sudo mv db_autopwn.rb/...
```
**Step 2**  
Load the file while in the MSF
```bash
msf6> load db_autopwn
```
Documentation  
(Gives some errors but don't have to worry)
```bash
db_autopwn
```
```bash
db_autopwn -p -t
```
```bash
db_autopwn -p -t -PI 445
```

#### Test your knowledge
Q1: Which command can be used to perform an Nmap scan and import results directly into the Metasploit database  
A : db_nmap

Q2: Which is the primary purpose of vulnerability scanning in the context of the Metasploit framework  
A : To Identify and exploit Metasploit exploit modules

Q3: What dows the auxiliary module for SMB-MS17-010 check  
A : Common misconfigurations in SMB

Q4: Which Metasploit plugin assists in identifying exploit modules based on currently open ports  
A : db_autopwn

Q5: In vulnerability scanning, which step is crucial before using exploit modules  
A : Confirming the target's service version information



Memo  
Required info to identify vulnerabilities: service version


#### ðŸ“‚ Note
`PostgreSQL`  
An opensource Relational Database Management System  
Similar to MySQL but more advanced feature  
Why it shows up in Metasploit  
-> Metasploit uses PostgreSQL as its default backend database to store:  
- Scan results
- Loot (found creds etc)
- Exploit info, session, workspace history

`How to know if a line is real module I can use`  
If it's listed proper path like  
- exploit/..
- auxiliary/..
- post/..
- scanner/..
- payload/..

`db_autopwn`  
\-p : Select modules based on open ports  
\-t : Show all matching exploit modules  
\-PI : Specify ports
